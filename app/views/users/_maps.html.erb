<% content_for :title, 'Calendar' %>

<h1> Maps </h1>


<!-- 
<div id="floating-panel">
  <b>Start: </b>
  <select id="start">
    <option value="chicago, il">Chicago</option>
    <option value="st louis, mo">St Louis</option>
    <option value="joplin, mo">Joplin, MO</option>
    <option value="oklahoma city, ok">Oklahoma City</option>
    <option value="amarillo, tx">Amarillo</option>
    <option value="gallup, nm">Gallup, NM</option>
    <option value="flagstaff, az">Flagstaff, AZ</option>
    <option value="winona, az">Winona</option>
    <option value="kingman, az">Kingman</option>
    <option value="barstow, ca">Barstow</option>
    <option value="san bernardino, ca">San Bernardino</option>
    <option value="los angeles, ca">Los Angeles</option>
  </select>
  <b>End: </b>
  <select id="end">
    <option value="chicago, il">Chicago</option>
    <option value="st louis, mo">St Louis</option>
    <option value="joplin, mo">Joplin, MO</option>
    <option value="oklahoma city, ok">Oklahoma City</option>
    <option value="amarillo, tx">Amarillo</option>
    <option value="gallup, nm">Gallup, NM</option>
    <option value="flagstaff, az">Flagstaff, AZ</option>
    <option value="winona, az">Winona</option>
    <option value="kingman, az">Kingman</option>
    <option value="barstow, ca">Barstow</option>
    <option value="san bernardino, ca">San Bernardino</option>
    <option value="los angeles, ca">Los Angeles</option>
  </select>
</div>
 -->

<div id="map"></div>


<style>
      /* Always set the map height explicitly to define the size of the div
      * element that contains the map. */
      #map {
        height: 480px;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
/*      #floating-panel {
        position: relative;
        top: 10px;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
        text-align: center;
        font-family: 'Roboto','sans-serif';
      }*/
    </style>

    <%= javascript_tag do %>
      window.events = <%= raw @events.to_json %>;
    <% end %>



<script>
  
  function initMap() {

    var directionsService = new google.maps.DirectionsService;
    var directionsDisplay = new google.maps.DirectionsRenderer;
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 12,
      center: {lat: 45.47529907632454, lng: 9.195771500000092}
    });
    directionsDisplay.setMap(map);

    // var onChangeHandler = function() {
    //   calculateAndDisplayRoute(directionsService, directionsDisplay);
    // };

    // $('.selector').addEventListener('click', onChangeHandler, true);
    $('.selector').click(function(){
      calculateAndDisplayRoute(directionsService, directionsDisplay, this.value);
    });
    // document.getElementById('btn').addEventListener('click', onChangeHandler, true);
  }

  function calculateAndDisplayRoute(directionsService, directionsDisplay, val) {
    if (val < 1) {
       window.alert('No possible for first event in the calendar')
    } else {
      directionsService.route({
        origin: window.events[val-1].location,
        destination: window.events[val].location,
        travelMode: 'DRIVING'
      }, 
      function(response, status) {
        if (status === 'OK') {
          directionsDisplay.setDirections(response);
        } else {
          window.alert('Directions request failed due to ' + status);
        }
      });
    }
  } 
</script>

<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAIr_46aBVmHpMxp1kh5qRKfvCrdEspwPM&callback=initMap">
</script>







